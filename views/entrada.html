<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Almacen Jony's</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light" style="background-color:rgb(229, 240, 127);">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">Almacen Jony's</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link active" href="graficos.html">Graficos</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="entrada.html">Entrada y Salida</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="vent2.html">Productos disponibles</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="../index.html">Cerrar sesion</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <div class="container">
        <div class="row mt-3">
            <div class="col-md-4">
              <form id="form-prendas" action="">
                <div class="card">
                  <div class="card-header">
                  Registro de entrada y salida
                  </div>
                  <div class="card-body">
                    <div class="mb-3">
                      <div class="mb-3 row g-2">
                        <div class="col-md">
                          <label for="movi" class="form-label">Movimiento:</label>
                           <select name="movi" id="movi" class="form-select form-select-sm" autofocus>
                            <option value="">Seleccione</option>
                            <option value="Entrada">Entrada</option>
                            <option value="Salida">Salida</option>
                          </select>
                        </div>
                      </div>
                      <div class="mb-3 row g-2">
                        <div class="col-md">
                          <label for="tipo" class="form-label">Categoria:</label>
                           <select name="tipo" id="tipo" class="form-select form-select-sm" autofocus>
                            <option value="">Seleccione</option>
                          </select>
                        </div>
                        <div class="col-md">
                          <label for="descripcion" class="form-label">Descripcion:</label>
                           <select name="descripcion" id="descripcion" class="form-select form-select-sm" autofocus>
                            <option value="">Seleccione</option>
                          </select>
                        </div>
                      </div>
                    <div class = "mb-3">
                      <label for="observaciones" class="form-label">Observaciones:</label>
                      <input type="text" class="form-control form-control-sm" id="observaciones">
                    </div>
                    <div class="mb-3">
                      <label for="cantidad" class="form-label">Cantidad:</label>
                      <input type="text" class="form-control form-control-sm" id="cantidad">
                    </div>
                  </div>
                  <div class="card-footer text-muted">
                    <div class="d-grid gap-2">
                      <button class="btn btn-sm" type="button" id="guardar" style="background-color: rgb(229, 240, 127);">Guardar</button>
                      <button class="btn btn-sm btn-secondary" type="reset" id="reiniciar">Reiniciar</button>
                    </div>
                  </div> 
                  </div>
                </div>
              </form>
            </div>
            <div class="col-md-12 mt-3">
              <table class="table table-sm table-striped" id="tabla-entrada">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Tipo prenda</th>
                    <th>Descripcion</th>
                    <th>Movimientos</th>
                    <th>Cantidad</th>
                    <th>Observaciones</th>
                    <th>Fecha</th>
                  </tr>
                </thead>
                <tbody>
  
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!--Formulario de registro de entrada-->
        
          
      </div>
        <!--Tabla-->
          
      </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const movi = document.querySelector("#movi");
  const tipo = document.querySelector("#tipo");
  const observaciones = document.querySelector("#observaciones");
  const cantidad = document.querySelector("#cantidad");
  const fecha = document.querySelector("#fecha");
  const descripcion = document.querySelector("#descripcion");
  const btguardar = document.querySelector("#guardar");
  const btreiniciar = document.querySelector("#reiniciar");
  const tabla = document.querySelector("#tabla-entrada");
  const cuerpoTabla = document.querySelector("tbody");


  function mostrarTipo(){
   const parametros = new URLSearchParams();
   parametros.append("operacion","listarTipoPrenda");
   fetch('../controllers/prendas.controller.php',{
     method: 'POST',
     body: parametros
   })
   .then(response => response.json())
   .then(lista => {
     lista.forEach(element => {
     const optionTag = document.createElement("option"); 
     optionTag.value = element.idtipoprenda;
     optionTag.text= element.tipoprenda;
     tipo.appendChild(optionTag);
       })
     }) 
  }

          function mostrarDescripcion(){
            const parametros = new URLSearchParams();
            parametros.append("operacion", "listarDescripcion");
            parametros.append("idtipoprenda", parseInt(tipo.value))

            fetch("../controllers/prendas.controller.php",{
              method: 'POST',
              body: parametros
            })
            .then(response => response.json())
            .then(lista => {
              lista.forEach(element => {
                const optionTag = document.createElement("option");
                optionTag.value = element.idprenda;
                optionTag.text = element.descripcion;
                descripcion.appendChild(optionTag);
              })
            })
          }
          
          function registrarMov(){
            if(confirm('Â¿Esta seguro de guardar los datos?')){
              const parametros = new URLSearchParams();
              parametros.append("operacion","registrarMovimientos");
              parametros.append("tipo", movi.value);
              parametros.append("idtipoprenda",tipo.value);
              parametros.append("idprenda", descripcion.value)
              parametros.append("cantidad", cantidad.value);
              parametros.append("observaciones", observaciones.value);

              fetch("../controllers/registro.controller.php", {
                method: 'POST',
                body: parametros
              })
                .then(response => response.json())
                .then(datos => {
                  if(datos.status){
                    document.querySelector("#form-prendas").reset();
                  }else{
                    alert(datos.mensaje)
                  }
                })
            }
          }

          function listaMovimientos(){
            const parametros = new URLSearchParams();
            parametros.append("operacion", "listarMovimientos");

            fetch("../controllers/registro.controller.php", {
              method: "POST",
              body: parametros
            })
            .then(response => response.json())
            .then(datos => {
              cuerpoTabla.innerHTML = ``;
              datos.forEach(element => {
                const fila = 
                `
                <tr>
                  <td>${element.idmovimiento}</td>
                  <td>${element.tipoprenda}</td>
                  <td>${element.descripcion}</td>
                  <td>${element.tipo}</td>
                  <td>${element.cantidad}</td>
                  <td>${element.observaciones}</td>
                  <td>${element.fecha}</td>
                </tr>
                `;
                cuerpoTabla.innerHTML +=fila;
              })
            })
          }

        btguardar.addEventListener("click", registrarMov);
        listaMovimientos();
        tipo.addEventListener("change", mostrarDescripcion);
        mostrarTipo();
        })
</script>
</body>
</html>